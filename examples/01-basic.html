<!doctype html>

<head>
	<title>Sphere Example</title>
	<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
	<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
	<script src="../dist/threebox.js" type="text/javascript"></script>
	<link href="../dist/threebox.css" rel="stylesheet" type="text/css" />
	<script src="config.js"></script>
	<style>
		body,
		html {
			width: 100%;
			height: 100%;
			margin: 0;
		}

		#map {
			width: 100%;
			height: 100%;
		}
	</style>
</head>

<body>
	<div id='map' class='map'></div>

	<script type="module">

		if (!config) console.error("Config not set! Make a copy of 'config_template.js', add in your access token, and save the file as 'config.js'.");

		mapboxgl.accessToken = config.accessToken;

		//starting location for both map and eventual sphere
		var origin = [104.57930721461173,
			28.70550951590245, 1];

		var map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/mapbox/light-v9',
			center: origin,
			zoom: 17,
			pitch: 60,
			antialias: true
		});

		// let stats;
		// import Stats from 'https://threejs.org/examples/jsm/libs/stats.module.js';
		function animate() {
			// requestAnimationFrame(animate);
			// stats.update();
		}

		map.on('style.load', function () {
			// stats
			// stats = new Stats();
			// map.getContainer().appendChild(stats.dom);
			animate();

			// instantiate threebox
			window.tb = new Threebox(
				map,
				map.getCanvas().getContext('webgl'),
				{
					defaultLights: true,
					enableSelectingObjects: true
				}
			);

			map.addLayer({
				id: 'custom_layer',
				type: 'custom',
				renderingMode: '3d',
				onAdd: function () {
					//instantiate a red sphere and position it at the origin lnglat
					// var sphere = tb.sphere({color: 'red', material: 'MeshToonMaterial'})
					// 	.setCoords(origin);
					// sphere.addEventListener('ObjectMouseOver', onObjectMouseOver, false);
					// sphere.addEventListener('ObjectMouseOut', onObjectMouseOut, false);
					// // add sphere to the scene
					// tb.add(sphere);

					const coneMaterial = new THREE.MeshBasicMaterial({ color: 0x007aff });
					// 创建圆锥
					const coneGeometry = new THREE.ConeGeometry(5, 10, 160);
					const cone = new THREE.Mesh(coneGeometry, coneMaterial);
					var sphere = tb.Object3D({ obj: cone, units: 'meters' }).setCoords(origin);
					sphere.addEventListener('ObjectMouseOver', (e) => {
						console.log("ObjectMouseOver: " + e.detail.name);
					}, false);
					sphere.addEventListener('ObjectMouseOut', (e) => {
						console.log("ObjectMouseOut: " + e.detail.name);
					}, false);
					// sphere.selected = true
					sphere.addTooltip("hdaida", true)
					sphere.name = "摄像头"
					sphere.rotation.x = -(Math.PI / 2);  // 使圆锥朝下
					// coneGeometry.translate(0, -5, 0);
					tb.add(sphere);

					const coneMaterial2 = new THREE.MeshBasicMaterial({ color: 0x007aff });
					// 创建圆锥
					const coneGeometry2 = new THREE.ConeGeometry(5, 10, 160);
					const cone2 = new THREE.Mesh(coneGeometry2, coneMaterial2);
					var sphere2 = tb.Object3D({ obj: cone2, units: 'meters' }).setCoords([104.57941153757366,
						28.70630930612002, 1]);
					sphere2.addEventListener('ObjectMouseOver', (e) => {
						console.log("ObjectMouseOver2: " + e.detail.name);
					}, false);
					sphere2.addEventListener('ObjectMouseOut', (e) => {
						console.log("ObjectMouseOut2: " + e.detail.name);
					}, false);
					// sphere.selected = true
					sphere2.addTooltip("hdaida2", true)
					sphere2.name = "摄像头2"
					sphere2.rotation.x = -(Math.PI / 2);  // 使圆锥朝下
					// coneGeometry.translate(0, -5, 0);
					tb.add(sphere2);

				},

				render: function (gl, matrix) {
					debugger
					console.log('-------------------')
					tb.update();
				}
			})
		});

		//actions to execute onObjectMouseOver
		function onObjectMouseOver(e) {
			console.log("ObjectMouseOver: " + e.detail.name);
		}

		//actions to execute onObjectMouseOut
		function onObjectMouseOut(e) {
			console.log("ObjectMouseOut: " + e.detail.name);
		}

	</script>
</body>